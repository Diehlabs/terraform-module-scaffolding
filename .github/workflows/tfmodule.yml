name: Terraform Module Build
on:
  push:
    branches:
      - '**'
  pull_request:
    branches:
      - 'main'
  workflow_dispatch:

env:
  TERRAFORM_VERSION: '1.1.6'
  TFLINT_VERSION: 'v0.34.1'
  WORKFLOWS_REF: 'master'

jobs:
  tflint:
    uses: Diehlabs/shared-workflows/tflint.yml@${{ env.WORKFLOWS_REF }}

  terrascan:
    uses: Diehlabs/shared-workflows/terrascan.yml@${{ env.WORKFLOWS_REF }}
    if: steps.tflint.outcome == 'success'

  checkov:
    uses: Diehlabs/shared-workflows/checkov.yml@${{ env.WORKFLOWS_REF }}
    if: steps.tflint.outcome == 'success'

  terratest:
    uses: Diehlabs/shared-workflows/terratest.yml@${{ env.WORKFLOWS_REF }}
    if: steps.tflint.outcome == 'success'

  tag:
    uses: Diehlabs/shared-workflows/github-release.yml@${{ env.WORKFLOWS_REF }}
    if: steps.terratest.outcome == 'success'